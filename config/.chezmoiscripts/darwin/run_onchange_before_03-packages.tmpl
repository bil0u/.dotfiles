#!/usr/bin/env bash
set -euo pipefail

{{ template "load-utils" . }}
{{ template "load-homebrew" . }}

filename "packages"

action "Installing packages ..."
brew bundle --no-lock --file=/dev/stdin <<EOF
# Taps
{{ range (.homebrew.taps | uniq) -}}
tap '{{ . }}'
{{ end -}}
# Formulaes
{{ range (.homebrew.formulaes | uniq) -}}
brew '{{ . }}'
{{ end -}}
# Casks
{{ range (.homebrew.casks | uniq) -}}
cask '{{ . }}'
{{ end -}}
# Mac AppStore
{{ range (.homebrew.mas | uniq) -}}
mas '{{ .name }}', id: {{ .id }}
{{ end -}}
EOF
